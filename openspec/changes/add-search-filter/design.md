## Context

cleam はAWS CloudWatch Logsを閲覧するRust製TUIアプリ。メイン画面では左パネルにロググループ、右パネルにログストリームを一覧表示する。現在は j/k でスクロールするのみ。

イベント画面にはすでに `/` キーで起動するフィルタ機能があるが、これはAWS API側でフィルタリングする実装（`filter_input` を API パラメータとして渡す）。

メイン画面の検索はすでにフェッチ済みのリストをクライアント側でフィルタリングする。

## Goals / Non-Goals

**Goals:**
- メイン画面のグループ・ストリームパネルでインライン検索（クライアント側フィルタ）を実現する
- `/` キーで検索バーを表示し、文字入力のたびにリストをリアルタイム絞り込みする
- `Esc` で検索を終了・クリアする
- 検索バーはアクティブパネル下部に表示する

**Non-Goals:**
- AWS API 側でのフィルタリング（メイン画面はクライアント側のみ）
- 正規表現検索（部分文字列マッチで十分）
- パネルをまたいだ横断検索
- ページネーション済みの未フェッチデータへの検索適用

## Decisions

### 1. フィルタ状態の保持場所

**決定**: `App` に `main_search_query: String` と `main_search_active: bool` を追加する。

- `main_search_query`: 現在の検索文字列（空文字 = フィルタなし）
- `main_search_active`: 検索バーが表示されキー入力を受け付けている状態

**代替案と却下理由**:
- `StatefulList<T>` に検索状態を持たせる案: グループ・ストリームで独立した状態管理が必要になり、パネル切り替え時の同期が複雑になる
- パネルごとに別のクエリを持つ案: UX が複雑になる。パネル切り替え時にクリアする方が直感的

### 2. フィルタリングの実装方法

**決定**: `StatefulList<T>` に `visible_indices: Option<Vec<usize>>` を追加し、ナビゲーション・選択ロジックをこのインデックスに基づかせる。

- `None`: フィルタなし（全件表示）
- `Some(vec)`: 表示すべき元リストのインデックス一覧

`next()` / `previous()` は `visible_indices` の長さを上限に動作する。`selected()` は `visible_indices[state.selected]` 経由で元の item を返す。

**代替案と却下理由**:
- UI描画時にのみ filtered vec を計算する案: ナビゲーション時（`handle_main_key`）でも filtered view が必要なため、App とUI の両方で計算が発生し重複する
- items を直接差し替える案: 元のリストが失われるため、検索クリア時の復元が困難

### 3. パネル切り替え時の検索状態

**決定**: パネル（h/l キー）切り替え時に検索をリセット（クエリクリア、検索バー非表示）する。

**理由**: グループ用クエリとストリーム用クエリが混在すると混乱を招く。シンプルなリセットが最も直感的。

## Risks / Trade-offs

- **ページネーション未取得データ**: フィルタはフェッチ済みアイテムのみに適用される。スクロール末尾でのページネーション読み込み後に visible_indices を再計算する必要がある。→ `check_pagination` 後に visible_indices を更新する処理を追加する
- **パフォーマンス**: `visible_indices` は文字入力のたびに全件線形スキャンするが、ロググループ・ストリーム数は通常数千件以下であり問題にならない
